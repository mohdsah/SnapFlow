<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kata Laluan Baru | SnapFlow</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background:#000; color:#fff; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:30px; }
        .auth-wrap { width:100%; max-width:380px; text-align:center; }
        .form-group { text-align:left; margin-bottom:14px; }
        .form-group label { font-size:12px; color:#555; display:block; margin-bottom:6px; }
        .form-group input { width:100%; background:#111; border:1px solid #2a2a2a; padding:14px 16px; border-radius:12px; color:#fff; font-size:15px; outline:none; transition:border-color 0.2s; box-sizing:border-box; font-family:inherit; }
        .form-group input:focus { border-color:#22c55e; }
        .strength-bar { height:4px; border-radius:4px; margin-top:6px; transition:all 0.3s; background:#1a1a1a; overflow:hidden; }
        .strength-fill { height:100%; border-radius:4px; transition:all 0.3s; width:0; }
    </style>
</head>
<body>
    <div class="auth-wrap">
        <div style="width:70px;height:70px;background:#001a07;border:1px solid #003a10;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;">
            <i class="fa-solid fa-lock" style="font-size:28px;color:#22c55e;"></i>
        </div>
        <h2 style="font-size:22px;font-weight:800;margin-bottom:10px;">Cipta Kata Laluan Baru</h2>
        <p style="color:#555;font-size:14px;margin-bottom:28px;">Masukkan kata laluan baru yang kuat untuk akaun anda.</p>

        <div class="form-group">
            <label>Kata Laluan Baru</label>
            <input type="password" id="new-password" placeholder="Min. 6 aksara"
                   autocomplete="new-password" oninput="semakKekuatan(this.value)"
                   onkeydown="if(event.key==='Enter') document.getElementById('confirm-password').focus()">
            <div class="strength-bar"><div class="strength-fill" id="strength-fill"></div></div>
            <span id="strength-label" style="font-size:11px;color:#555;margin-top:4px;display:block;"></span>
        </div>

        <div class="form-group" style="margin-bottom:24px;">
            <label>Ulang Kata Laluan</label>
            <input type="password" id="confirm-password" placeholder="Masukkan semula kata laluan"
                   autocomplete="new-password" onkeydown="if(event.key==='Enter') updateUserPassword()">
        </div>

        <button onclick="updateUserPassword()" class="login-btn-main">
            <i class="fa-solid fa-check" style="margin-right:6px;"></i> Kemaskini Kata Laluan
        </button>
    </div>

    <script src="app.js"></script>
    <script>
    // Indicator kekuatan kata laluan
    function semakKekuatan(pass) {
        var fill  = document.getElementById('strength-fill');
        var label = document.getElementById('strength-label');
        if (!pass) { fill.style.width = '0'; label.textContent = ''; return; }
        var score = 0;
        if (pass.length >= 6)  score++;
        if (pass.length >= 10) score++;
        if (/[A-Z]/.test(pass)) score++;
        if (/[0-9]/.test(pass)) score++;
        if (/[^a-zA-Z0-9]/.test(pass)) score++;
        var pct    = ['0%','25%','50%','75%','100%'][score];
        var warna  = ['#ef4444','#f59e0b','#eab308','#22c55e','#16a34a'][score];
        var teks   = ['','Lemah','Sederhana','Baik','Kuat'][score];
        fill.style.width = pct;
        fill.style.background = warna;
        label.style.color = warna;
        label.textContent = teks;
    }

    // Supabase akan detect token dari URL hash secara automatik
    // melalui onAuthStateChange â†’ PASSWORD_RECOVERY event
    </script>

    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js').catch(function(){});
        });
    }
    </script>
</body>
</html>
